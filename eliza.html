<!DOCTYPE html>
<html lang="en">
  <head>
    <title>ELIZA Chat Bot</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body>
    <header>
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <span class="navbar-brand navbar-title">ELIZA</span>
      </nav>
    </header>
    <main class="container frame">
      <ul>
          <li style="width: 100%"> 
            <div class="msj macro"> 
                <div class="text text-l"> 
                  <p>Hi</p> 
                  <p><small>2017-11-13 21:52</small></p>
                </div> 
            </div> 
          </li>
          <li style="width: 100%;"> 
            <div class="msj-rta macro"> 
                <div class="text text-r"> 
                  <p>Hey</p> 
                  <p><small>2017-11-13 21:53</small></p>
                </div>
            </div>                                
          </li>
      </ul>
    </main>
    <footer class="fixed-bottom text-light bg-dark">
      <form class="form-inline">
        <section class="form-group msj-rta macro" style="margin:auto; justify-content: flex-end">
          <label class="sr-only" for="user-input">User input</label>
          <div class="input-group text-r" style="background:whitesmoke !important; flex-grow: 5">
              <input name="user-input" class="form-control mytext required" placeholder="Type a message"/>
          </div>
          <div class="btn-group">
            <button class="btn btn-primary" type="submit">Send</button>
          </div>
        </section>
      </form>
    </footer>
    <!-- <p id="response"></p> -->

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
    <script>
      $( document ).ready(function() {

        $("form").submit(function(event){
          event.preventDefault();
          // console.log( "form submitted" );

          var userInput = $('input[name=user-input]').val();

          var formData = JSON.stringify({
            'UserMessage' : userInput
          });

          console.log(formData);

          // https://stackoverflow.com/questions/8701812/clear-form-after-submission-with-jquery
          $( "form" ).each(function(){
            this.reset();
          });

          // https://stackoverflow.com/questions/3552461/how-to-format-a-javascript-date
          // https://stackoverflow.com/questions/5631384/remove-everything-after-a-certain-character
          // var timestamp = new Date().toISOString().replace("T", " ").replace(/\..*/, "")
          var timestamp = new Date().toISOString().replace("T", " ").replace("Z", "")
          
          // console.log(timestamp);

          // https://stackoverflow.com/questions/1145208/jquery-how-to-add-li-in-an-existing-ul
          $("ul li:last")
            .after($('<li>')
              .append($('<div>')
                .append($('<div>')
                  .append($('<p>')
                    .append(userInput))
                    .append($('<p>')
                      .append($('<small>')
                        .append(timestamp)
                      )
                    )
                  .addClass("text text-r"))
                .addClass("msj-rta macro"))
              .css("width", "100%")
            );

          // https://scotch.io/tutorials/submitting-ajax-forms-with-jquery
          $.ajax({
          url: '/ajax',
          type: "post",
          contentType: 'application/json; charset=utf-8',
          data: formData,
          dataType: 'json',
          encode: true 
          })
          .done(function(response) {
            console.log(response)
            // $('#response').append(response.ElizaMessage);

            $("ul li:last")
            .after($('<li>')
              .append($('<div>')
                .append($('<div>')
                  .append($('<p>')
                    .append(response.ElizaMessage))
                    .append($('<p>')
                      .append($('<small>')
                        .append(timestamp)
                      )
                    )
                  .addClass("text text-l"))
                .addClass("msj-rta macro"))
              .css("width", "100%")
            ); // $("ul li:last")

          }) // $.ajax().done()

          .fail(function(data) {
            // show any errors
            console.log(data);
          }) // $.ajax().fail()
          ; // $.ajax

        }); // $("#input-form").submit

      }); // $( document ).ready
    </script>
  </body>
</html>
